<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .admin-section {
            border-color: #4CAF50;
            background-color: #f9fff9;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #da190b;
        }
        button.info {
            background-color: #2196F3;
        }
        button.info:hover {
            background-color: #0b7dda;
        }
        button.success {
            background-color: #4CAF50;
        }
        button.success:hover {
            background-color: #45a049;
        }
        .response {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        input, select, textarea {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        input[type="number"] {
            width: 100px;
        }
        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .form-group {
            margin: 10px 0;
        }
        .service-item {
            border: 1px solid #eee;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .service-item h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .service-item p {
            margin: 5px 0;
            color: #666;
        }
        .services-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        
        /* æ²»ç–—å¸ˆåˆ—è¡¨æ ·å¼ */
        .therapists-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .therapist-item {
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 5px;
            background-color: #fafafa;
            width: calc(33.333% - 20px);
            box-sizing: border-box;
            transition: box-shadow 0.3s;
        }
        
        .therapist-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .therapist-item h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .therapist-item p {
            margin: 8px 0;
            color: #666;
        }
        
        .book-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 10px 0 0 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .book-button:hover {
            background-color: #45a049;
        }
        
        /* æœåŠ¡é¡¹ç›®é€‰æ‹©ç•Œé¢æ ·å¼ */
        .service-selection-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .service-selection-container h3 {
            margin-top: 0;
            color: #333;
        }
        
        .service-selection-container > div {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .service-selection-list {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .service-selection-item {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 5px;
            background-color: #fafafa;
        }
        
        .service-selection-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .service-selection-item p {
            margin: 5px 0;
            color: #666;
        }
        
        .select-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 10px 0 0 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .select-button:hover {
            background-color: #0b7dda;
        }
        
        .cancel-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 10px 0 0 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .cancel-button:hover {
            background-color: #da190b;
        }
    </style>
</head>
<body>
    <h1>APIæµ‹è¯•é¡µé¢</h1>
    <p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„APIæµ‹è¯•é¡µé¢ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•åç«¯APIã€‚</p>

    <!-- ç”¨æˆ·æ³¨å†Œæµ‹è¯• -->
    <div class="test-section">
        <h2>1. ç”¨æˆ·æ³¨å†Œ</h2>
        <input type="text" id="register-username" placeholder="ç”¨æˆ·å" value="testuser">
        <input type="password" id="register-password" placeholder="å¯†ç " value="123456">
        <input type="text" id="register-phone" placeholder="æ‰‹æœºå·" value="13800138000">
        <select id="register-role">
            <option value="user">æ™®é€šç”¨æˆ·</option>
            <option value="therapist">æ²»ç–—å¸ˆ</option>
        </select>
        <button onclick="testRegister()">æ³¨å†Œç”¨æˆ·</button>
        <div id="register-response" class="response"></div>
    </div>

    <!-- ç”¨æˆ·ç™»å½•æµ‹è¯• -->
    <div class="test-section">
        <h2>2. ç”¨æˆ·ç™»å½•</h2>
        <input type="text" id="login-username" placeholder="ç”¨æˆ·å" value="testuser">
        <input type="password" id="login-password" placeholder="å¯†ç " value="123456">
        <button onclick="testLogin()">ç™»å½•</button>
        <div id="login-response" class="response"></div>
    </div>

    <!-- è·å–æœåŠ¡åˆ—è¡¨æµ‹è¯• -->
    <div class="test-section">
        <h2>3. è·å–æœåŠ¡åˆ—è¡¨</h2>
        <button onclick="testGetServices()">è·å–æœåŠ¡åˆ—è¡¨</button>
        <div id="services-list" class="services-list"></div>
        <div id="services-response" class="response"></div>
    </div>

    <!-- è·å–æ²»ç–—å¸ˆåˆ—è¡¨æµ‹è¯• -->
    <div class="test-section">
        <h2>4. è·å–æ²»ç–—å¸ˆåˆ—è¡¨</h2>
        <button onclick="testGetTherapists()">è·å–æ²»ç–—å¸ˆåˆ—è¡¨</button>
        <div id="therapists-response" class="response"></div>
        <div id="therapists-list" class="therapists-container"></div>
    </div>
    
    <!-- æœåŠ¡é¡¹ç›®é€‰æ‹©ç•Œé¢ -->
    <div id="service-selection" class="service-selection-container"></div>

    <!-- åˆ›å»ºè®¢å•æµ‹è¯• -->
    <div id="create-order-section" class="test-section">
        <h2>5. åˆ›å»ºè®¢å•</h2>
        <div class="form-row">
            <input type="number" id="create-order-therapist-id" placeholder="æŠ€å¸ˆID" value="2">
            <input type="number" id="create-order-service-item-id" placeholder="æœåŠ¡é¡¹ç›®ID" value="1">
            <input type="datetime-local" id="create-order-service-time" placeholder="æœåŠ¡æ—¶é—´" value="2025-01-20T14:00">
            <input type="text" id="create-order-service-address" placeholder="æœåŠ¡åœ°å€" value="åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·">
            <input type="text" id="create-order-contact-phone" placeholder="è”ç³»ç”µè¯" value="13800138000">
            <textarea id="create-order-remark" placeholder="å¤‡æ³¨" rows="3" style="width: 200px;"></textarea>
            <button onclick="testCreateOrder()">åˆ›å»ºè®¢å•</button>
        </div>
        <div id="create-order-response" class="response"></div>
    </div>

    <!-- è·å–æ²»ç–—å¸ˆè¯¦æƒ…æµ‹è¯• -->
    <div class="test-section">
        <h2>6. è·å–æ²»ç–—å¸ˆè¯¦æƒ…</h2>
        <input type="number" id="therapist-id" placeholder="æ²»ç–—å¸ˆID" value="5">
        <button onclick="testGetTherapistDetail()">è·å–è¯¦æƒ…</button>
        <div id="therapist-detail" class="response"></div>
    </div>

    <!-- æäº¤æ²»ç–—å¸ˆè¯„ä»·æµ‹è¯• -->
    <div class="test-section">
        <h2>6. æäº¤æ²»ç–—å¸ˆè¯„ä»·</h2>
        <input type="number" id="feedback-order-id" placeholder="è®¢å•ID" value="1">
        <input type="number" id="feedback-rating" placeholder="è¯„åˆ†(1-5)" value="5" min="1" max="5">
        <input type="text" id="feedback-content" placeholder="è¯„ä»·å†…å®¹" value="æœåŠ¡éå¸¸å¥½ï¼Œæ²»ç–—å¸ˆå¾ˆä¸“ä¸šï¼">
        <input type="text" id="feedback-tags" placeholder="æ ‡ç­¾(ç”¨é€—å·åˆ†éš”)" value="ä¸“ä¸š,æœåŠ¡å¥½,ç¯å¢ƒèˆ’é€‚">
        <button onclick="testSubmitFeedback()">æäº¤è¯„ä»·</button>
        <div id="feedback-response" class="response"></div>
    </div>

    <!-- è®¢å•æµç¨‹æŸ¥çœ‹ -->
    <div class="test-section">
        <h2>7. è®¢å•æµç¨‹æŸ¥çœ‹</h2>
        <div class="form-row">
            <button onclick="testGetOrders()">è·å–è®¢å•åˆ—è¡¨</button>
            <input type="number" id="order-detail-id" placeholder="è®¢å•ID" value="1">
            <button onclick="testGetOrderDetail()">æŸ¥çœ‹è®¢å•æµç¨‹</button>
        </div>
        <div id="orders-list" class="response" style="max-height: 300px; overflow-y: auto;"></div>
        <div id="order-detail-view" class="response"></div>
        <div id="order-process-view" class="response">
            <style>
                .process-container {
                    margin: 20px 0;
                    padding: 20px;
                    background-color: #f8f9fa;
                    border-radius: 8px;
                }
                .process-step {
                    display: flex;
                    align-items: center;
                    margin: 20px 0;
                    position: relative;
                }
                .process-step:not(:last-child)::after {
                    content: '';
                    position: absolute;
                    left: 30px;
                    top: 30px;
                    width: 2px;
                    height: calc(100% - 30px);
                    background-color: #ddd;
                }
                .process-icon {
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                    z-index: 1;
                    background-color: #fff;
                    border: 3px solid #ddd;
                }
                .process-step.completed .process-icon {
                    background-color: #4CAF50;
                    color: white;
                    border-color: #4CAF50;
                }
                .process-step.current .process-icon {
                    background-color: #2196F3;
                    color: white;
                    border-color: #2196F3;
                    box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.2);
                }
                .process-info {
                    margin-left: 20px;
                    flex: 1;
                }
                .process-info h4 {
                    margin: 0;
                    color: #333;
                }
                .process-info p {
                    margin: 5px 0;
                    color: #666;
                }
                .process-time {
                    color: #999;
                    font-size: 12px;
                }
            </style>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜ - åˆ›å»ºæœåŠ¡å¥—é¤ -->
    <div class="test-section admin-section">
        <h2>7. ç®¡ç†å‘˜ - åˆ›å»ºæœåŠ¡å¥—é¤</h2>
        <p>ä»…ç®¡ç†å‘˜å¯ä½¿ç”¨æ­¤åŠŸèƒ½</p>
        <div class="form-row">
            <input type="text" id="create-service-name" placeholder="æœåŠ¡åç§°" value="298å…¨èº«æŒ‰æ‘©">
            <input type="number" id="create-service-price" placeholder="ä»·æ ¼" value="298" step="0.01">
            <input type="number" id="create-service-duration" placeholder="æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰" value="90">
            <textarea id="create-service-description" placeholder="æœåŠ¡æè¿°" rows="3" style="width: 300px;">ä¸“ä¸šå…¨èº«ç²¾æ²¹æŒ‰æ‘©ï¼Œèˆ’ç¼“ç–²åŠ³ï¼Œæ”¾æ¾èº«å¿ƒ</textarea>
            <button onclick="testCreateService()">åˆ›å»ºæœåŠ¡</button>
        </div>
        <div id="create-service-response" class="response"></div>
    </div>

    <!-- ç®¡ç†å‘˜ - æœåŠ¡ç®¡ç†åˆ—è¡¨ -->
    <div class="test-section admin-section">
        <h2>8. ç®¡ç†å‘˜ - æœåŠ¡ç®¡ç†</h2>
        <p>ä»…ç®¡ç†å‘˜å¯ä½¿ç”¨æ­¤åŠŸèƒ½</p>
        <button onclick="testGetAllServices()" class="info">åˆ·æ–°æœåŠ¡åˆ—è¡¨</button>
        <div id="services-list" class="services-list"></div>
        <div id="service-management-response" class="response"></div>
    </div>

    <script>
        // å­˜å‚¨JWTä»¤ç‰Œ
        let token = '';

        // ç”¨æˆ·æ³¨å†Œ
        async function testRegister() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const phone = document.getElementById('register-phone').value;
            const role = document.getElementById('register-role').value;

            const response = await fetch('/api/user/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username,
                    password,
                    phone,
                    role
                })
            });

            const result = await response.json();
            document.getElementById('register-response').textContent = JSON.stringify(result, null, 2);
        }

        // ç”¨æˆ·ç™»å½•
        async function testLogin() {
            const phone = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const response = await fetch('/api/user/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phone,
                    password
                })
            });

            const result = await response.json();
            document.getElementById('login-response').textContent = JSON.stringify(result, null, 2);
            
            // ä¿å­˜ä»¤ç‰Œ
            if (result.data && result.data.access_token) {
                token = result.data.access_token;
                console.log('ç™»å½•æˆåŠŸï¼Œä»¤ç‰Œå·²ä¿å­˜:', token);
            } else if (result.access_token) {
                token = result.access_token;
                console.log('ç™»å½•æˆåŠŸï¼Œä»¤ç‰Œå·²ä¿å­˜:', token);
            } else {
                console.error('ç™»å½•æˆåŠŸä½†æœªè¿”å›è®¿é—®ä»¤ç‰Œ:', result);
            }
        }

        // è·å–æœåŠ¡åˆ—è¡¨
        async function testGetServices() {
            const response = await fetch('/api/service/items', {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            
            if (result.data && Array.isArray(result.data)) {
                // æ˜¾ç¤ºæœåŠ¡åˆ—è¡¨
                const servicesList = document.getElementById('services-list');
                servicesList.innerHTML = '';
                
                result.data.forEach(service => {
                    const serviceItem = document.createElement('div');
                    serviceItem.className = 'service-item';
                    serviceItem.innerHTML = `
                        <h3>${service.name}</h3>
                        <p>ä»·æ ¼: Â¥${service.price.toFixed(2)}</p>
                        <p>æ—¶é•¿: ${service.duration}åˆ†é’Ÿ</p>
                        <p>${service.description || 'æ— æè¿°'}</p>
                        <button onclick="viewServiceDetail(${service.id})" class="info">æŸ¥çœ‹è¯¦æƒ…</button>
                        <button onclick="selectServiceForOrder(${service.id}, '${service.name}')" class="success">ç«‹å³ä¸‹å•</button>
                    `;
                    servicesList.appendChild(serviceItem);
                });
            } else {
                document.getElementById('services-list').innerHTML = '<p>è·å–æœåŠ¡åˆ—è¡¨å¤±è´¥</p>';
                console.error('è·å–æœåŠ¡åˆ—è¡¨å¤±è´¥ï¼ŒAPIè¿”å›ç»“æ„ä¸æ­£ç¡®:', result);
            }
            
            document.getElementById('services-response').textContent = JSON.stringify(result, null, 2);
        }
        
        // æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
        async function viewServiceDetail(serviceId) {
            const response = await fetch(`/api/service/items/${serviceId}`, {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });
            
            const result = await response.json();
            if (result.code === 200 && result.data) {
                const service = result.data;
                alert(`æœåŠ¡è¯¦æƒ…:\nåç§°: ${service.name}\nä»·æ ¼: Â¥${service.price.toFixed(2)}\næ—¶é•¿: ${service.duration}åˆ†é’Ÿ\næè¿°: ${service.description || 'æ— æè¿°'}`);
            } else {
                alert('è·å–æœåŠ¡è¯¦æƒ…å¤±è´¥');
                console.error('è·å–æœåŠ¡è¯¦æƒ…å¤±è´¥:', result);
            }
        }
        
        // é€‰æ‹©æœåŠ¡ç”¨äºä¸‹å•
        function selectServiceForOrder(serviceId, serviceName) {
            // å°†æœåŠ¡IDå¡«å……åˆ°åˆ›å»ºè®¢å•çš„è¡¨å•ä¸­
            document.getElementById('create-order-service-item-id').value = serviceId;
            alert(`å·²é€‰æ‹©æœåŠ¡: ${serviceName}\nè¯·é€‰æ‹©æ²»ç–—å¸ˆå¹¶å¡«å†™å…¶ä»–è®¢å•ä¿¡æ¯åç‚¹å‡»åˆ›å»ºè®¢å•`);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åˆ›å»ºè®¢å•åŒºåŸŸ
            document.getElementById('create-order-service-item-id').scrollIntoView({ behavior: 'smooth' });
        }

        // è·å–æ²»ç–—å¸ˆåˆ—è¡¨
        async function testGetTherapists() {
            const response = await fetch('/api/therapist/list', {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            
            if (result.code === 200 && result.data && Array.isArray(result.data)) {
                // æ˜¾ç¤ºæ²»ç–—å¸ˆåˆ—è¡¨
                const therapistsList = document.getElementById('therapists-list');
                therapistsList.innerHTML = '';
                
                result.data.forEach(therapist => {
                    const therapistItem = document.createElement('div');
                    therapistItem.className = 'therapist-item';
                    therapistItem.innerHTML = `
                        <h3>${therapist.name}</h3>
                        <p>ID: ${therapist.id}</p>
                        <p>å¹´é¾„: ${therapist.age}å²</p>
                        <p>è¯„åˆ†: ${therapist.rating.toFixed(1)}æ˜Ÿ</p>
                        <p>æœåŠ¡æ¬¡æ•°: ${therapist.service_count}</p>
                        <p>ä¸“é•¿: ${therapist.specialty}</p>
                        <p>ç»éªŒ: ${therapist.experience_years}å¹´</p>
                        <p>${therapist.introduction || 'æ— è‡ªæˆ‘ä»‹ç»'}</p>
                        <button onclick="bookTherapist(${therapist.id}, '${therapist.name}')" class="book-button">é¢„å®š</button>
                    `;
                    therapistsList.appendChild(therapistItem);
                });
            } else {
                document.getElementById('therapists-list').innerHTML = '<p>è·å–æ²»ç–—å¸ˆåˆ—è¡¨å¤±è´¥</p>';
                console.error('è·å–æ²»ç–—å¸ˆåˆ—è¡¨å¤±è´¥ï¼ŒAPIè¿”å›ç»“æ„ä¸æ­£ç¡®:', result);
            }
        }
        
        // é¢„å®šæ²»ç–—å¸ˆ - æ˜¾ç¤ºæœåŠ¡é¡¹ç›®é€‰æ‹©
        async function bookTherapist(therapistId, therapistName) {
            // è·å–è¯¥æ²»ç–—å¸ˆçš„æœåŠ¡é¡¹ç›®
            const response = await fetch(`/api/therapist/${therapistId}`, {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });
            
            const result = await response.json();
            
            if (result.code === 200 && result.data) {
                const therapist = result.data;
                const serviceItems = therapist.service_items || [];
                
                // æ˜¾ç¤ºæœåŠ¡é¡¹ç›®é€‰æ‹©ç•Œé¢
                const serviceSelection = document.getElementById('service-selection');
                serviceSelection.innerHTML = `
                    <h3>é€‰æ‹© ${therapistName} çš„æœåŠ¡é¡¹ç›®</h3>
                    <div class="service-selection-list"></div>
                    <button onclick="closeServiceSelection()" class="cancel-button">å–æ¶ˆ</button>
                `;
                
                const serviceList = serviceSelection.querySelector('.service-selection-list');
                
                if (serviceItems.length > 0) {
                    serviceItems.forEach(item => {
                        const serviceItem = document.createElement('div');
                        serviceItem.className = 'service-selection-item';
                        serviceItem.innerHTML = `
                            <h4>${item.name}</h4>
                            <p>ä»·æ ¼: Â¥${item.price.toFixed(2)}</p>
                            <p>æ—¶é•¿: ${item.duration}åˆ†é’Ÿ</p>
                            <p>${item.description || 'æ— æè¿°'}</p>
                            <button onclick="createOrderForTherapist(${therapistId}, ${item.id}, '${therapistName}', '${item.name}')" class="select-button">é€‰æ‹©æ­¤æœåŠ¡</button>
                        `;
                        serviceList.appendChild(serviceItem);
                    });
                } else {
                    serviceList.innerHTML = '<p>è¯¥æ²»ç–—å¸ˆæš‚æ— æœåŠ¡é¡¹ç›®</p>';
                }
                
                // æ˜¾ç¤ºæœåŠ¡é€‰æ‹©åŒºåŸŸ
                serviceSelection.style.display = 'block';
            } else {
                alert('è·å–æ²»ç–—å¸ˆä¿¡æ¯å¤±è´¥');
            }
        }
        
        // å…³é—­æœåŠ¡é€‰æ‹©ç•Œé¢
        function closeServiceSelection() {
            document.getElementById('service-selection').style.display = 'none';
        }
        
        // ä¸ºæ²»ç–—å¸ˆåˆ›å»ºè®¢å•
        function createOrderForTherapist(therapistId, serviceItemId, therapistName, serviceName) {
            // å¡«å……è®¢å•åˆ›å»ºè¡¨å•
            document.getElementById('create-order-therapist-id').value = therapistId;
            document.getElementById('create-order-service-item-id').value = serviceItemId;
            
            // æ˜¾ç¤ºè®¢å•åˆ›å»ºåŒºåŸŸ
            document.getElementById('service-selection').style.display = 'none';
            document.getElementById('create-order-section').scrollIntoView({ behavior: 'smooth' });
            
            alert(`è¯·å¡«å†™è®¢å•ä¿¡æ¯ä»¥é¢„å®š ${therapistName} çš„ ${serviceName}`);
        }

        // åˆ›å»ºè®¢å•
        async function testCreateOrder() {
            const therapistId = parseInt(document.getElementById('create-order-therapist-id').value);
            const serviceItemId = parseInt(document.getElementById('create-order-service-item-id').value);
            const serviceTime = document.getElementById('create-order-service-time').value;
            const serviceAddress = document.getElementById('create-order-service-address').value;
            const contactPhone = document.getElementById('create-order-contact-phone').value;
            const remark = document.getElementById('create-order-remark').value;

            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!therapistId || !serviceItemId || !serviceTime || !serviceAddress || !contactPhone) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }

            try {
                // åˆ›å»ºè®¢å•
                const response = await fetch('/api/order/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token ? `Bearer ${token}` : ''
                    },
                    body: JSON.stringify({
                        therapist_id: therapistId,
                        service_item_id: serviceItemId,
                        service_time: serviceTime,
                        service_address: serviceAddress,
                        contact_phone: contactPhone,
                        remark: remark
                    })
                });

                const result = await response.json();
                document.getElementById('create-order-response').textContent = JSON.stringify(result, null, 2);

                // å¦‚æœè®¢å•åˆ›å»ºæˆåŠŸï¼Œè‡ªåŠ¨å‘èµ·æ”¯ä»˜
                if (result.code === 200) {
                    const orderId = result.data.id;
                    alert(`è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•å·ï¼š${result.data.order_no}ï¼Œæ­£åœ¨ä¸ºæ‚¨å‘èµ·æ”¯ä»˜...`);
                    await createPaymentForOrder(orderId);
                } else {
                    alert(`è®¢å•åˆ›å»ºå¤±è´¥ï¼š${result.message}`);
                }
            } catch (error) {
                console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error);
                alert('åˆ›å»ºè®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ä¸ºè®¢å•å‘èµ·æ”¯ä»˜
        async function createPaymentForOrder(orderId) {
            try {
                const response = await fetch(`/api/order/${orderId}/pay`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token ? `Bearer ${token}` : ''
                    },
                    body: JSON.stringify({
                        payment_method: 'wechat'
                    })
                });

                const result = await response.json();
                const paymentResponseDiv = document.createElement('div');
                paymentResponseDiv.style.marginTop = '10px';
                paymentResponseDiv.innerHTML = `<strong>æ”¯ä»˜ä¿¡æ¯:</strong><br>${JSON.stringify(result, null, 2)}`;
                
                // ç§»é™¤æ—§çš„æ”¯ä»˜ä¿¡æ¯
                const existingPaymentInfo = document.getElementById('payment-info');
                if (existingPaymentInfo) {
                    existingPaymentInfo.remove();
                }
                
                paymentResponseDiv.id = 'payment-info';
                document.getElementById('create-order-response').appendChild(paymentResponseDiv);

                if (result.code === 200) {
                    // åœ¨å®é™…å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨å¾®ä¿¡æ”¯ä»˜SDK
                    // æ¨¡æ‹Ÿå¾®ä¿¡æ”¯ä»˜ç•Œé¢è°ƒç”¨
                    alert('å·²ç”Ÿæˆæ”¯ä»˜å‚æ•°ï¼Œæ­£åœ¨è°ƒèµ·å¾®ä¿¡æ”¯ä»˜...');
                    console.log('å¾®ä¿¡æ”¯ä»˜å‚æ•°:', result.data.payment_params);
                    
                    // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸåçš„æ“ä½œ
                    setTimeout(async () => {
                        // æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
                        const statusResponse = await fetch(`/api/order/${orderId}/payment/status`, {
                            headers: {
                                'Authorization': token ? `Bearer ${token}` : ''
                            }
                        });
                        const statusResult = await statusResponse.json();
                        
                        if (statusResult.code === 200) {
                            alert('æ”¯ä»˜æˆåŠŸï¼æ‚¨çš„è®¢å•å·²å®Œæˆæ”¯ä»˜');
                            // æ›´æ–°æ”¯ä»˜çŠ¶æ€æ˜¾ç¤º
                            const paymentStatusDiv = document.createElement('div');
                            paymentStatusDiv.style.marginTop = '10px';
                            paymentStatusDiv.innerHTML = `<strong>æ”¯ä»˜çŠ¶æ€:</strong><br>${JSON.stringify(statusResult.data, null, 2)}`;
                            document.getElementById('create-order-response').appendChild(paymentStatusDiv);
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('å‘èµ·æ”¯ä»˜å¤±è´¥:', error);
                alert('å‘èµ·æ”¯ä»˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ç®¡ç†å‘˜ - åˆ›å»ºæœåŠ¡å¥—é¤
        async function testCreateService() {
            const name = document.getElementById('create-service-name').value;
            const price = parseFloat(document.getElementById('create-service-price').value);
            const duration = parseInt(document.getElementById('create-service-duration').value);
            const description = document.getElementById('create-service-description').value;

            if (!name || !price || !duration) {
                alert('è¯·å¡«å†™æœåŠ¡åç§°ã€ä»·æ ¼å’Œæ—¶é•¿');
                return;
            }

            const response = await fetch('/api/service/items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token ? `Bearer ${token}` : ''
                },
                body: JSON.stringify({
                    name,
                    price,
                    description,
                    duration
                })
            });

            const result = await response.json();
            document.getElementById('create-service-response').textContent = JSON.stringify(result, null, 2);
            
            // åˆ·æ–°æœåŠ¡åˆ—è¡¨
            if (response.ok) {
                testGetAllServices();
            }
        }

        // ç®¡ç†å‘˜ - è·å–æ‰€æœ‰æœåŠ¡åˆ—è¡¨ï¼ˆç”¨äºç®¡ç†ï¼‰
        async function testGetAllServices() {
            const response = await fetch('/api/service/items', {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            
            if (result.data && Array.isArray(result.data)) {
                // æ˜¾ç¤ºæœåŠ¡åˆ—è¡¨
                const servicesList = document.getElementById('services-list');
                servicesList.innerHTML = '';
                
                result.data.forEach(service => {
                    const serviceItem = document.createElement('div');
                    serviceItem.className = 'service-item';
                    serviceItem.innerHTML = `
                        <h3>${service.name}</h3>
                        <p>ä»·æ ¼: Â¥${service.price.toFixed(2)}</p>
                        <p>æ—¶é•¿: ${service.duration}åˆ†é’Ÿ</p>
                        <p>ID: ${service.id}</p>
                        <p>${service.description || 'æ— æè¿°'}</p>
                        <button onclick="editService(${service.id})" class="info">ç¼–è¾‘</button>
                        <button onclick="deleteService(${service.id})" class="danger">åˆ é™¤</button>
                    `;
                    servicesList.appendChild(serviceItem);
                });
            } else {
                document.getElementById('services-list').innerHTML = '<p>è·å–æœåŠ¡åˆ—è¡¨å¤±è´¥</p>';
                console.error('è·å–æœåŠ¡åˆ—è¡¨å¤±è´¥ï¼ŒAPIè¿”å›ç»“æ„ä¸æ­£ç¡®:', result);
            }
        }

        // ç®¡ç†å‘˜ - åˆ é™¤æœåŠ¡
        async function deleteService(serviceId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæœåŠ¡å—ï¼Ÿ')) {
                return;
            }

            const response = await fetch(`/api/service/items/${serviceId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            const responseDiv = document.getElementById('service-management-response');
            responseDiv.textContent = JSON.stringify(result, null, 2);
            
            // åˆ·æ–°æœåŠ¡åˆ—è¡¨
            if (response.ok) {
                testGetAllServices();
            }
        }

        // ç®¡ç†å‘˜ - ç¼–è¾‘æœåŠ¡ï¼ˆç®€å•å®ç°ï¼‰
        async function editService(serviceId) {
            const newName = prompt('è¯·è¾“å…¥æ–°çš„æœåŠ¡åç§°ï¼š');
            if (!newName) return;
            
            const newPrice = parseFloat(prompt('è¯·è¾“å…¥æ–°çš„æœåŠ¡ä»·æ ¼ï¼š'));
            if (isNaN(newPrice)) return;
            
            const newDescription = prompt('è¯·è¾“å…¥æ–°çš„æœåŠ¡æè¿°ï¼š');

            const response = await fetch(`/api/service/items/${serviceId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token ? `Bearer ${token}` : ''
                },
                body: JSON.stringify({
                    name: newName,
                    price: newPrice,
                    description: newDescription
                })
            });

            const result = await response.json();
            const responseDiv = document.getElementById('service-management-response');
            responseDiv.textContent = JSON.stringify(result, null, 2);
            
            // åˆ·æ–°æœåŠ¡åˆ—è¡¨
            if (response.ok) {
                testGetAllServices();
            }
        }

        // è·å–æ²»ç–—å¸ˆè¯¦æƒ…
        async function testGetTherapistDetail() {
            const therapistId = document.getElementById('therapist-id').value;
            if (!therapistId) {
                alert('è¯·è¾“å…¥æ²»ç–—å¸ˆID');
                return;
            }

            const response = await fetch(`/api/therapist/${therapistId}`, {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            if (result.code === 200 && result.data) {
                const therapist = result.data;
                let html = `<h3>${therapist.name} - ç†ç–—å¸ˆè¯¦æƒ…</h3>`;
                html += `<p>ID: ${therapist.id}</p>`;
                html += `<p>å¹´é¾„: ${therapist.age}å²</p>`;
                html += `<p>è¯„åˆ†: ${therapist.rating.toFixed(1)}æ˜Ÿ</p>`;
                html += `<p>æœåŠ¡æ¬¡æ•°: ${therapist.service_count}</p>`;
                html += `<p>ä¸“é•¿: ${therapist.specialty}</p>`;
                html += `<p>ç»éªŒ: ${therapist.experience_years}å¹´</p>`;
                html += `<p>å¤´åƒ: ${therapist.avatar || 'æ— å¤´åƒ'}</p>`;
                html += `<p>è‡ªæˆ‘ä»‹ç»:</p><p>${therapist.introduction || 'æ— è‡ªæˆ‘ä»‹ç»'}</p>`;
                
                // æ˜¾ç¤ºæœåŠ¡é¡¹ç›®
                if (therapist.service_items && therapist.service_items.length > 0) {
                    html += '<h4>æœåŠ¡é¡¹ç›®:</h4><ul>';
                    therapist.service_items.forEach(item => {
                        html += `<li>${item.name} - Â¥${item.price.toFixed(2)} (${item.duration}åˆ†é’Ÿ)</li>`;
                    });
                    html += '</ul>';
                }
                
                // æ˜¾ç¤ºç”¨æˆ·è¯„ä»·
                if (therapist.feedbacks && therapist.feedbacks.length > 0) {
                    html += '<h4>ç”¨æˆ·è¯„ä»·:</h4>';
                    therapist.feedbacks.forEach(feedback => {
                        html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">`;
                        html += `<p>è¯„åˆ†: ${'â˜…'.repeat(feedback.rating)} (${feedback.rating}åˆ†)</p>`;
                        html += `<p>å†…å®¹: ${feedback.content}</p>`;
                        if (feedback.tags && feedback.tags.length > 0) {
                            html += `<p>æ ‡ç­¾: ${feedback.tags.join(', ')}</p>`;
                        }
                        html += `<p>ç”¨æˆ·: ${feedback.user_info.username || 'åŒ¿åç”¨æˆ·'} - ${new Date(feedback.created_at).toLocaleString()}</p>`;
                        html += '</div>';
                    });
                }
                
                document.getElementById('therapist-detail').innerHTML = html;
            } else {
                document.getElementById('therapist-detail').innerHTML = `<p>è·å–æ²»ç–—å¸ˆè¯¦æƒ…å¤±è´¥: ${result.message || 'æœªçŸ¥é”™è¯¯'}</p>`;
            }
        }

        // æäº¤æ²»ç–—å¸ˆè¯„ä»·
        async function testSubmitFeedback() {
            const orderId = document.getElementById('feedback-order-id').value;
            const rating = parseInt(document.getElementById('feedback-rating').value);
            const content = document.getElementById('feedback-content').value;
            const tags = document.getElementById('feedback-tags').value;

            if (!orderId || !rating || !content) {
                alert('è¯·å¡«å†™å®Œæ•´çš„è¯„ä»·ä¿¡æ¯');
                return;
            }

            if (rating < 1 || rating > 5) {
                alert('è¯„åˆ†å¿…é¡»åœ¨1-5ä¹‹é—´');
                return;
            }

            const response = await fetch('/api/feedback/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token ? `Bearer ${token}` : ''
                },
                body: JSON.stringify({
                    order_id: parseInt(orderId),
                    rating,
                    content,
                    tags
                })
            });

            const result = await response.json();
            const responseDiv = document.getElementById('feedback-response');
            responseDiv.textContent = JSON.stringify(result, null, 2);
        }

        // è·å–è®¢å•åˆ—è¡¨
        async function testGetOrders() {
            const response = await fetch('/api/order/list', {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            const ordersList = document.getElementById('orders-list');
            
            if (result.code === 200 && result.data && Array.isArray(result.data.items)) {
                let html = '<h3>è®¢å•åˆ—è¡¨:</h3><ul>';
                result.data.items.forEach(order => {
                    const statusText = getOrderStatusText(order.status);
                    html += `<li style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>è®¢å•å·: ${order.order_no}</strong><br>
                        æœåŠ¡: ${order.service_name} - Â¥${order.price}<br>
                        çŠ¶æ€: ${statusText}<br>
                        æ²»ç–—å¸ˆ: ${order.therapist_name || 'æœªåˆ†é…'}<br>
                        <button onclick="document.getElementById(\'order-detail-id\').value=${order.id}; testGetOrderDetail();">æŸ¥çœ‹è¯¦æƒ…</button>
                    </li>`;
                });
                html += '</ul>';
                ordersList.innerHTML = html;
            } else {
                ordersList.innerHTML = `<p>è·å–è®¢å•åˆ—è¡¨å¤±è´¥: ${result.message || 'æœªçŸ¥é”™è¯¯'}</p>`;
            }
        }

        // è·å–è®¢å•è¯¦æƒ…
        async function testGetOrderDetail() {
            const orderId = document.getElementById('order-detail-id').value;
            if (!orderId) {
                alert('è¯·è¾“å…¥è®¢å•ID');
                return;
            }

            const response = await fetch(`/api/order/${orderId}`, {
                method: 'GET',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : ''
                }
            });

            const result = await response.json();
            const orderDetailView = document.getElementById('order-detail-view');
            const orderProcessView = document.getElementById('order-process-view');
            
            if (result.code === 200 && result.data) {
                const order = result.data;
                const statusText = getOrderStatusText(order.status);
                const paymentStatusText = getPaymentStatusText(order.payment_status || 0);
                
                // æ˜¾ç¤ºè®¢å•è¯¦æƒ…
                orderDetailView.innerHTML = `
                    <h3>è®¢å•è¯¦æƒ…</h3>
                    <p><strong>è®¢å•å·:</strong> ${order.order_no}</p>
                    <p><strong>æœåŠ¡é¡¹ç›®:</strong> ${order.service_name}</p>
                    <p><strong>ä»·æ ¼:</strong> Â¥${order.price}</p>
                    <p><strong>æ—¶é•¿:</strong> ${order.duration}åˆ†é’Ÿ</p>
                    <p><strong>æœåŠ¡æ—¶é—´:</strong> ${order.service_time ? new Date(order.service_time).toLocaleString() : 'æœªè®¾ç½®'}</p>
                    <p><strong>æœåŠ¡åœ°å€:</strong> ${order.service_address}</p>
                    <p><strong>è”ç³»ç”µè¯:</strong> ${order.contact_phone}</p>
                    <p><strong>è®¢å•çŠ¶æ€:</strong> ${statusText}</p>
                    <p><strong>æ”¯ä»˜çŠ¶æ€:</strong> ${paymentStatusText}</p>
                    <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(order.created_at).toLocaleString()}</p>
                `;
                
                // æ˜¾ç¤ºè®¢å•æµç¨‹
                renderOrderProcess(order.status);
            } else {
                orderDetailView.innerHTML = `<p>è·å–è®¢å•è¯¦æƒ…å¤±è´¥: ${result.message || 'æœªçŸ¥é”™è¯¯'}</p>`;
                orderProcessView.innerHTML = '';
            }
        }

        // æ¸²æŸ“è®¢å•æµç¨‹
        function renderOrderProcess(currentStatus) {
            const processSteps = [
                { status: 0, text: 'è®¢å•åˆ›å»º', icon: 'ğŸ“‹', description: 'ç”¨æˆ·å·²ä¸‹å•ï¼Œç­‰å¾…æ²»ç–—å¸ˆæ¥å•' },
                { status: 1, text: 'å·²æ¥å•', icon: 'ğŸ‘Œ', description: 'æ²»ç–—å¸ˆå·²æ¥å—è®¢å•ï¼Œå‡†å¤‡æœåŠ¡' },
                { status: 2, text: 'å‡ºå‘ä¸­', icon: 'ğŸš—', description: 'æ²»ç–—å¸ˆæ­£åœ¨å‰å¾€æœåŠ¡åœ°ç‚¹' },
                { status: 3, text: 'æœåŠ¡ä¸­', icon: 'ğŸ’†', description: 'æ²»ç–—å¸ˆæ­£åœ¨æä¾›æœåŠ¡' },
                { status: 4, text: 'æœåŠ¡å®Œæˆ', icon: 'âœ…', description: 'æœåŠ¡å·²å®Œæˆï¼Œç­‰å¾…ç”¨æˆ·è¯„ä»·' },
                { status: 5, text: 'å·²å–æ¶ˆ', icon: 'âŒ', description: 'è®¢å•å·²å–æ¶ˆ' }
            ];
            
            const orderProcessView = document.getElementById('order-process-view');
            let html = '<h3>è®¢å•æµç¨‹</h3><div class="process-container">';
            
            processSteps.forEach(step => {
                let className = '';
                if (currentStatus === step.status) {
                    className = 'current';
                } else if (currentStatus > step.status && step.status !== 5) {
                    className = 'completed';
                } else if (currentStatus === 5 && step.status === 5) {
                    className = 'current';
                }
                
                html += `<div class="process-step ${className}">
                    <div class="process-icon">${step.icon}</div>
                    <div class="process-info">
                        <h4>${step.text}</h4>
                        <p>${step.description}</p>
                    </div>
                </div>`;
            });
            
            html += '</div>';
            orderProcessView.innerHTML += html;
        }

        // è·å–è®¢å•çŠ¶æ€æ–‡æœ¬
        function getOrderStatusText(status) {
            const statusMap = {
                0: 'å¾…æ¥å•',
                1: 'å·²æ¥å•',
                2: 'å‡ºå‘ä¸­',
                3: 'æœåŠ¡ä¸­',
                4: 'å·²å®Œæˆ',
                5: 'å·²å–æ¶ˆ'
            };
            return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';
        }

        // è·å–æ”¯ä»˜çŠ¶æ€æ–‡æœ¬
        function getPaymentStatusText(status) {
            const statusMap = {
                0: 'æœªæ”¯ä»˜',
                1: 'å·²æ”¯ä»˜',
                2: 'æ”¯ä»˜å¤±è´¥',
                3: 'å·²é€€æ¬¾'
            };
            return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';
        }
    </script>
</body>
</html>