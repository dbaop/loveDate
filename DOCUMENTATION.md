# lovaDate 项目文档

## 1. 产品介绍

lovaDate是一个基于Flask框架开发的服务预约系统，主要用于提供按摩、理疗等健康服务的在线预约和管理功能。系统支持用户浏览服务、预约服务，管理员管理服务项目和用户订单等功能。

### 1.1 核心功能

- **用户功能**：
  - 用户注册和登录
  - 浏览服务项目
  - 预约服务
  - 查看订单

- **管理员功能**：
  - 服务项目管理（创建、编辑、删除）
  - 用户管理
  - 订单管理
  - 系统设置

## 2. 整体设计方案

### 2.1 系统架构

lovaDate采用前后端分离的架构设计：

- **后端**：基于Flask框架开发的RESTful API
- **前端**：简单的HTML页面（static/index.html），可扩展为小程序或移动应用
- **数据库**：SQLite（开发环境），可扩展为MySQL

### 2.2 项目结构

```
lovaDate/
├── app/
│   ├── api/             # API路由定义
│   ├── models/          # 数据模型
│   ├── services/        # 业务逻辑
│   └── utils/           # 工具函数
├── static/              # 静态资源
├── main.py              # 应用入口
├── config.py            # 配置文件
└── requirements.txt     # 依赖管理
```

### 2.3 核心模块

#### 2.3.1 认证模块（app/utils/auth.py）

提供用户认证和权限控制功能：
- JWT令牌生成和验证
- 用户登录认证
- 管理员权限验证

#### 2.3.2 服务模块（app/api/service.py）

提供服务项目的CRUD操作：
- 获取服务列表
- 创建服务项目
- 更新服务项目
- 删除服务项目

#### 2.3.3 数据模型（app/models/）

定义系统的数据结构：
- User：用户模型
- ServiceItem：服务项目模型
- Order：订单模型

## 3. 核心功能流程

### 3.1 用户注册登录流程

1. 用户提交注册信息
2. 系统验证信息并创建用户
3. 用户使用用户名密码登录
4. 系统验证并返回JWT令牌
5. 用户使用令牌访问受保护的API

### 3.2 服务预约流程

1. 用户浏览服务列表
2. 选择服务项目
3. 选择预约时间和技师
4. 确认订单信息
5. 系统创建订单并返回订单号

### 3.3 服务管理流程（管理员）

1. 管理员登录系统
2. 进入服务管理页面
3. 创建/编辑/删除服务项目
4. 系统保存修改并更新服务列表

## 4. 与小程序调试流程

### 4.1 环境准备

1. 确保后端服务正常运行：
   ```bash
   python main.py
   ```

2. 确保后端服务可以被小程序访问（配置CORS）

3. 小程序开发工具中配置后端API地址

### 4.2 调试步骤

1. **接口测试**：
   - 使用Postman或curl测试API接口
   - 确保所有API返回正确的状态码和数据格式

2. **小程序集成**：
   - 在小程序中配置API基础地址
   - 实现登录、获取服务列表等功能
   - 使用小程序开发工具的调试功能查看网络请求

3. **问题排查**：
   - 检查后端日志（logs/app_dev.log）
   - 检查小程序控制台的错误信息
   - 使用调试工具捕获网络请求和响应

### 4.3 常见问题及解决方案

1. **跨域问题**：
   - 确保后端配置了正确的CORS策略
   - 检查小程序开发工具的域名白名单设置

2. **认证失败**：
   - 检查JWT令牌是否正确
   - 检查令牌是否过期
   - 检查权限控制是否正确

3. **数据格式错误**：
   - 确保前端发送的数据格式与后端期望一致
   - 检查JSON序列化和反序列化过程

## 5. 注意事项

### 5.1 开发注意事项

1. **安全性**：
   - 密码必须加密存储
   - API必须进行身份验证和授权
   - 输入数据必须进行验证和过滤

2. **性能**：
   - 数据库查询必须优化
   - 避免不必要的API调用
   - 使用缓存提高性能

3. **可维护性**：
   - 代码必须有清晰的注释
   - 遵循统一的代码风格
   - 模块化设计，便于扩展

### 5.2 部署注意事项

1. **环境配置**：
   - 使用虚拟环境隔离依赖
   - 配置正确的环境变量
   - 设置适当的日志级别

2. **数据库**：
   - 生产环境使用MySQL或PostgreSQL
   - 定期备份数据库
   - 配置适当的索引

3. **安全配置**：
   - 禁用调试模式
   - 配置HTTPS
   - 设置适当的文件权限

### 5.3 运营注意事项

1. **服务管理**：
   - 定期更新服务项目信息
   - 监控服务预约情况
   - 及时处理用户反馈

2. **数据分析**：
   - 分析用户行为数据
   - 统计服务预约量
   - 优化服务流程

## 6. 总结

lovaDate是一个功能完善的服务预约系统，具有良好的扩展性和可维护性。通过本文档，您可以了解系统的整体设计、核心功能流程以及与小程序的调试方法。在开发和运营过程中，请遵循相关注意事项，确保系统的安全性、性能和稳定性。

---

**文档更新记录**：
- 2024-01-15：初始版本
- 2024-01-16：补充服务管理功能说明